<!doctype html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>صورتحساب ماهک</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css"
          integrity="sha384-dpuaG1suU0eT09tx5plTaGMLBsfDLzUCCUXOY2j/LSvXYuG6Bqs43ALlhIqAJVRb" crossorigin="anonymous">
    <style>
        :root {
            font-size: 16px;
        }

        @font-face {
            font-family: 'font';
            src: url('font-regular.ttf');
            font-style: normal;
            font-weight: normal;
        }

        body {
            font-family: 'font', Arial;
        }

        table.invoice {
            width: 100%
        }

        table.invoice th {
            font-size: 1rem;
            font-weight: bold;
        }

        table.invoice td {
            border: thin solid;
        }

        input {
            width: 100%;
            text-align: center;
        }

        @media print {
            input {
                border: none;
                background: none;
            }
        }
    </style>
</head>
<body>
<div class="container py-2" id="app-container">
    <div class="text-center">
        <h1>لوازم التحریر ماهک</h1>
        <table class="invoice">
            <thead>
            <tr>
                <th>ردیف</th>
                <th>عنوان</th>
                <th>تعداد</th>
                <th>قیمت</th>
                <th>مجموع</th>
            </tr>
            </thead>
            <tbody v-if="items">
            <tr v-for="(x,k) in items">
                <td @dblclick="removeItem(k)">{{k + 1}}</td>
                <template v-if="mode === 'form'">
                    <td><input type="text" v-model="x.title" class="text-start"/></td>
                    <td><input type="tel" v-model="x.count"/></td>
                    <td><input type="tel" v-model="x.price"/></td>
                </template>
                <template v-if="mode === 'print'">
                    <td>{{x.title}}</td>
                    <td>{{thousandSeparator(x.count)}}</td>
                    <td>{{thousandSeparator(x.price)}}</td>
                </template>
                <td>{{thousandSeparator(Math.ceil((x.price || 0) * (x.count || 1)))}}</td>
            </tr>
            </tbody>
            <tfoot>
            <tr class="border-top" @click="mode = 'form'">
                <th colspan="4" class="text-start">مجموع</th>
                <td>
                    {{thousandSeparator(items.reduce((p, c) => p + Math.ceil((c.count || 1) * (c.price || 0)), 0) || 0)}}
                </td>
            </tr>
            </tfoot>
        </table>
        <div class="mt-5 text-center d-print-none" v-if="mode === 'form'">
            <hr/>
            <button class="btn btn-primary" @click="addNewItem">
                افزودن سطر جدید
            </button>
            <button class="btn btn-warning ms-2" @click="mode = 'print'">
                چاپ
            </button>
            <button class="btn btn-success ms-2" @click="saveForm">
                ذخیره فرم
            </button>
        </div>
        <hr/>
        <div class="mt-4 text-center">
            <table class="mx-auto">
                <tbody class="text-start">
                <tr>
                    <td>تلگرام</td>
                    <td dir="ltr" class="text-end">@maahaktahrir</td>
                </tr>
                <tr>
                    <td>اینستاگرام</td>
                    <td dir="ltr" class="text-end">@mahaktahrir</td>
                </tr>
                <tr>
                    <td>روبیکا</td>
                    <td dir="ltr" class="text-end">@mahaktahrir</td>
                </tr>
                <tr>
                    <td colspan="2" class="text-center border-top">
                        استان گیلان، شهر رودسر، لوازم التحریر ماهک<br/>
                        <span class="fw-bolder">سید محمدی</span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    function onVueLoad() {
        const app = Vue.createApp({
            data: () => ({
                items: [{count: 1}],
                mode: 'form'
            }),
            methods: {
                addNewItem() {
                    this.items.push({count: 1});
                },
                thousandSeparator(input) {
                    return (input || '0').toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                },
                saveForm() {
                    const blob = new Blob([JSON.stringify(this.items)], {type: 'application/json'});
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = Date.now() + '.json';
                    a.click();
                },
                removeItem(k) {
                    if (this.mode === 'form' && confirm('از حذف اطمینان دارید؟')) {
                        this.items.splice(k, 1);
                    }
                }
            }
        });
        app.mount('#app-container')
    }
</script>
<!--<script src="https://unpkg.com/vue@3/dist/vue.global.js" async onload="onVueLoad()"></script>-->
<script src="/vue.global.js" async onload="onVueLoad()"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>